{% extends "base.html" %}

{% block content %}
<style>
    .preview-card {
        background: white;
        border-radius: 15px;
        padding: 30px;
        margin-bottom: 20px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }

    .preview-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 25px;
        padding-bottom: 15px;
        border-bottom: 2px solid #f0f0f0;
    }

    .preview-header h2 {
        color: #333;
        font-size: 1.5em;
        margin: 0;
    }

    .count-badge {
        background: #667eea;
        color: white;
        padding: 5px 15px;
        border-radius: 20px;
        font-weight: 600;
    }

    .item {
        background: #f8f9ff;
        border-left: 4px solid #667eea;
        padding: 20px;
        margin-bottom: 15px;
        border-radius: 8px;
    }

    .item-header {
        display: flex;
        justify-content: space-between;
        align-items: start;
        margin-bottom: 15px;
    }

    .item-title {
        font-size: 1.2em;
        font-weight: 600;
        color: #333;
    }

    .item-badge {
        background: #28a745;
        color: white;
        padding: 4px 12px;
        border-radius: 15px;
        font-size: 0.85em;
        font-weight: 600;
    }

    .item-details {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        margin-top: 15px;
    }

    .detail {
        display: flex;
        flex-direction: column;
    }

    .detail-label {
        font-size: 0.85em;
        color: #666;
        margin-bottom: 4px;
        font-weight: 600;
    }

    .detail-value {
        color: #333;
        font-size: 1em;
    }

    .route {
        display: flex;
        align-items: center;
        gap: 10px;
        margin: 15px 0;
    }

    .route-airport {
        font-size: 1.3em;
        font-weight: bold;
        color: #667eea;
    }

    .route-arrow {
        color: #999;
        font-size: 1.5em;
    }

    .actions {
        display: flex;
        gap: 15px;
        justify-content: center;
        margin-top: 30px;
    }

    .btn-primary {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        padding: 15px 40px;
        font-size: 1.1em;
        border-radius: 10px;
        cursor: pointer;
        font-weight: 600;
        box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        transition: all 0.3s;
    }

    .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
    }

    .btn-secondary {
        background: white;
        color: #667eea;
        border: 2px solid #667eea;
        padding: 15px 40px;
        font-size: 1.1em;
        border-radius: 10px;
        cursor: pointer;
        font-weight: 600;
        transition: all 0.3s;
    }

    .btn-secondary:hover {
        background: #f8f9ff;
    }

    .warning {
        background: #fff3cd;
        border: 2px solid #ffc107;
        padding: 15px 20px;
        border-radius: 10px;
        margin-bottom: 20px;
        color: #856404;
    }

    .info-box {
        background: #d1ecf1;
        border: 2px solid #17a2b8;
        padding: 15px 20px;
        border-radius: 10px;
        margin-bottom: 20px;
        color: #0c5460;
    }

    .hotel-item {
        border-left-color: #28a745;
    }

    @media (max-width: 768px) {
        .item-details {
            grid-template-columns: 1fr;
        }

        .actions {
            flex-direction: column;
        }

        .btn-primary, .btn-secondary {
            width: 100%;
        }
    }
</style>

<div class="card">
    <h1 style="text-align: center; color: #333; margin-bottom: 10px;">ğŸ“‹ Review Your Travel Details</h1>
    <p style="text-align: center; color: #666; margin-bottom: 30px;">
        Please verify the information below before creating your calendar file
    </p>

    {% if flights|length == 0 and hotels|length == 0 %}
    <div class="warning">
        <strong>âš ï¸ No Data Found</strong><br>
        We couldn't find any flights or hotels in the PDF. Please make sure you're uploading a valid CWT travel agent PDF.
    </div>
    <div style="text-align: center; margin-top: 20px;">
        <a href="{{ url_for('index') }}" class="btn-secondary">â† Go Back</a>
    </div>
    {% else %}

    <div class="info-box">
        ğŸ’¡ <strong>What will be created:</strong> For each flight, you'll get 3 events (commute to airport, flight, commute from airport). Hotels get check-in/check-out times.
    </div>

    <!-- Flights Section -->
    {% if flights %}
    <div class="preview-card">
        <div class="preview-header">
            <h2>âœˆï¸ Flights</h2>
            <span class="count-badge">{{ flights|length }} flight{{ 's' if flights|length != 1 else '' }}</span>
        </div>

        {% for flight in flights %}
        <div class="item">
            <div class="item-header">
                <div class="item-title">{{ flight.flight_number }}</div>
                <div class="item-badge">Flight {{ loop.index }}</div>
            </div>

            <div class="route">
                <span class="route-airport">{{ flight.origin }}</span>
                <span class="route-arrow">â†’</span>
                <span class="route-airport">{{ flight.destination }}</span>
            </div>

            <div class="item-details">
                <div class="detail">
                    <span class="detail-label">Departure</span>
                    <span class="detail-value">{{ flight.departure_time.strftime('%A, %B %d, %Y at %I:%M %p') }}</span>
                </div>
                <div class="detail">
                    <span class="detail-label">Arrival</span>
                    <span class="detail-value">{{ flight.arrival_time.strftime('%A, %B %d, %Y at %I:%M %p') }}</span>
                </div>
                <div class="detail">
                    <span class="detail-label">Reservation Code</span>
                    <span class="detail-value">{{ flight.reservation_code or 'N/A' }}</span>
                </div>
                {% if flight.ticket_number %}
                <div class="detail">
                    <span class="detail-label">Ticket Number</span>
                    <span class="detail-value">{{ flight.ticket_number }}</span>
                </div>
                {% endif %}
            </div>
        </div>
        {% endfor %}
    </div>
    {% endif %}

    <!-- Hotels Section -->
    {% if hotels %}
    <div class="preview-card">
        <div class="preview-header">
            <h2>ğŸ¨ Hotels</h2>
            <span class="count-badge">{{ hotels|length }} hotel{{ 's' if hotels|length != 1 else '' }}</span>
        </div>

        {% for hotel in hotels %}
        <div class="item hotel-item">
            <div class="item-header">
                <div class="item-title">{{ hotel.name }}</div>
                <div class="item-badge" style="background: #28a745;">Hotel {{ loop.index }}</div>
            </div>

            <div class="item-details">
                <div class="detail">
                    <span class="detail-label">Check-in</span>
                    <span class="detail-value">{{ hotel.checkin_date.strftime('%A, %B %d, %Y') }} at 3:00 PM</span>
                </div>
                <div class="detail">
                    <span class="detail-label">Check-out</span>
                    <span class="detail-value">{{ hotel.checkout_date.strftime('%A, %B %d, %Y') }} at 12:00 PM</span>
                </div>
                {% if hotel.confirmation_number %}
                <div class="detail">
                    <span class="detail-label">Confirmation</span>
                    <span class="detail-value">{{ hotel.confirmation_number }}</span>
                </div>
                {% endif %}
                {% if hotel.address %}
                <div class="detail">
                    <span class="detail-label">Address</span>
                    <span class="detail-value">{{ hotel.address }}</span>
                </div>
                {% endif %}
                {% if hotel.phone %}
                <div class="detail">
                    <span class="detail-label">Phone</span>
                    <span class="detail-value">{{ hotel.phone }}</span>
                </div>
                {% endif %}
            </div>
        </div>
        {% endfor %}
    </div>
    {% endif %}

    <!-- Customization Settings -->
    <form method="POST" action="{{ url_for('generate_ics') }}">
        <input type="hidden" name="session_id" value="{{ session_id }}">

        <div class="preview-card">
            <div class="preview-header">
                <h2>âš™ï¸ Customize Settings</h2>
            </div>

            <div class="alert alert-warning" style="background: #fff3cd; border-left: 4px solid #ffc107; padding: 15px; margin-bottom: 20px; color: #856404;">
                <strong>ğŸ“Œ Note about colors:</strong> Google Calendar doesn't support colors in ICS files.
                After importing, you'll need to manually change the event colors in Google Calendar.
                The color selections below are for reference and will be included in the file metadata.
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 25px;">
                <!-- Color Settings -->
                <div>
                    <label style="display: block; font-weight: 600; color: #333; margin-bottom: 8px;">
                        âœˆï¸ Flight & Commute Color (Reference)
                    </label>
                    <select name="flight_color" style="width: 100%; padding: 10px; border: 2px solid #667eea; border-radius: 8px; font-size: 1em;">
                        <option value="11" selected>ğŸŒ¸ Flamingo (Default)</option>
                        <option value="1">ğŸ’œ Lavender</option>
                        <option value="2">ğŸ’š Sage</option>
                        <option value="3">ğŸ‡ Grape</option>
                        <option value="4">ğŸŒ¸ Blossom</option>
                        <option value="5">ğŸŒ Banana</option>
                        <option value="6">ğŸŒ¿ Basil</option>
                        <option value="7">ğŸ”µ Peacock</option>
                        <option value="8">ğŸŒ«ï¸ Graphite</option>
                        <option value="9">ğŸ’™ Blueberry</option>
                        <option value="10">ğŸŠ Tangerine</option>
                    </select>
                </div>

                <div>
                    <label style="display: block; font-weight: 600; color: #333; margin-bottom: 8px;">
                        ğŸ¨ Hotel Color (Reference)
                    </label>
                    <select name="hotel_color" style="width: 100%; padding: 10px; border: 2px solid #667eea; border-radius: 8px; font-size: 1em;">
                        <option value="6" selected>ğŸŒ¿ Sage (Default)</option>
                        <option value="1">ğŸ’œ Lavender</option>
                        <option value="2">ğŸ’š Basil Light</option>
                        <option value="3">ğŸ‡ Grape</option>
                        <option value="4">ğŸŒ¸ Blossom</option>
                        <option value="5">ğŸŒ Banana</option>
                        <option value="7">ğŸ”µ Peacock</option>
                        <option value="8">ğŸŒ«ï¸ Graphite</option>
                        <option value="9">ğŸ’™ Blueberry</option>
                        <option value="10">ğŸŠ Tangerine</option>
                        <option value="11">ğŸŒ¸ Flamingo</option>
                    </select>
                </div>
            </div>

            <!-- Airport Commute Times -->
            <h3 style="margin-bottom: 15px; color: #333;">ğŸš— Commute Before Departure</h3>
            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-bottom: 25px;">
                <div>
                    <label style="display: block; font-weight: 600; color: #555; margin-bottom: 5px; font-size: 0.9em;">ğŸ‡¨ğŸ‡± SCL</label>
                    <select name="scl_before" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 5px;">
                        <option value="2.5" selected>2.5 hours</option>
                        <option value="2.0">2 hours</option>
                        <option value="3.0">3 hours</option>
                        <option value="3.5">3.5 hours</option>
                        <option value="4.0">4 hours</option>
                        <option value="5.0">5 hours</option>
                    </select>
                </div>
                <div>
                    <label style="display: block; font-weight: 600; color: #555; margin-bottom: 5px; font-size: 0.9em;">ğŸ‡¦ğŸ‡· AEP</label>
                    <select name="aep_before" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 5px;">
                        <option value="3.5" selected>3.5 hours</option>
                        <option value="2.0">2 hours</option>
                        <option value="2.5">2.5 hours</option>
                        <option value="3.0">3 hours</option>
                        <option value="4.0">4 hours</option>
                        <option value="5.0">5 hours</option>
                    </select>
                </div>
                <div>
                    <label style="display: block; font-weight: 600; color: #555; margin-bottom: 5px; font-size: 0.9em;">ğŸ‡¦ğŸ‡· EZE</label>
                    <select name="eze_before" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 5px;">
                        <option value="3.5" selected>3.5 hours</option>
                        <option value="2.0">2 hours</option>
                        <option value="2.5">2.5 hours</option>
                        <option value="3.0">3 hours</option>
                        <option value="4.0">4 hours</option>
                        <option value="5.0">5 hours</option>
                    </select>
                </div>
                <div>
                    <label style="display: block; font-weight: 600; color: #555; margin-bottom: 5px; font-size: 0.9em;">ğŸ‡§ğŸ‡· GRU</label>
                    <select name="gru_before" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 5px;">
                        <option value="3.5" selected>3.5 hours</option>
                        <option value="2.0">2 hours</option>
                        <option value="2.5">2.5 hours</option>
                        <option value="3.0">3 hours</option>
                        <option value="4.0">4 hours</option>
                        <option value="5.0">5 hours</option>
                    </select>
                </div>
                <div>
                    <label style="display: block; font-weight: 600; color: #555; margin-bottom: 5px; font-size: 0.9em;">ğŸ‡²ğŸ‡½ MEX</label>
                    <select name="mex_before" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 5px;">
                        <option value="3.5" selected>3.5 hours</option>
                        <option value="2.0">2 hours</option>
                        <option value="2.5">2.5 hours</option>
                        <option value="3.0">3 hours</option>
                        <option value="4.0">4 hours</option>
                        <option value="5.0">5 hours</option>
                    </select>
                </div>
                <div>
                    <label style="display: block; font-weight: 600; color: #555; margin-bottom: 5px; font-size: 0.9em;">ğŸŒ Other Intl</label>
                    <select name="international_before" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 5px;">
                        <option value="3.5" selected>3.5 hours</option>
                        <option value="2.0">2 hours</option>
                        <option value="2.5">2.5 hours</option>
                        <option value="3.0">3 hours</option>
                        <option value="4.0">4 hours</option>
                        <option value="5.0">5 hours</option>
                    </select>
                </div>
            </div>

            <h3 style="margin-bottom: 15px; color: #333;">ğŸš— Commute After Landing</h3>
            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px;">
                <div>
                    <label style="display: block; font-weight: 600; color: #555; margin-bottom: 5px; font-size: 0.9em;">ğŸ‡¨ğŸ‡± SCL</label>
                    <select name="scl_after" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 5px;">
                        <option value="1.0" selected>1 hour</option>
                        <option value="0.5">0.5 hours</option>
                        <option value="1.5">1.5 hours</option>
                        <option value="2.0">2 hours</option>
                        <option value="3.0">3 hours</option>
                    </select>
                </div>
                <div>
                    <label style="display: block; font-weight: 600; color: #555; margin-bottom: 5px; font-size: 0.9em;">ğŸ‡¦ğŸ‡· AEP</label>
                    <select name="aep_after" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 5px;">
                        <option value="1.0" selected>1 hour</option>
                        <option value="0.5">0.5 hours</option>
                        <option value="1.5">1.5 hours</option>
                        <option value="2.0">2 hours</option>
                        <option value="3.0">3 hours</option>
                    </select>
                </div>
                <div>
                    <label style="display: block; font-weight: 600; color: #555; margin-bottom: 5px; font-size: 0.9em;">ğŸ‡¦ğŸ‡· EZE</label>
                    <select name="eze_after" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 5px;">
                        <option value="1.5" selected>1.5 hours</option>
                        <option value="0.5">0.5 hours</option>
                        <option value="1.0">1 hour</option>
                        <option value="2.0">2 hours</option>
                        <option value="3.0">3 hours</option>
                    </select>
                </div>
                <div>
                    <label style="display: block; font-weight: 600; color: #555; margin-bottom: 5px; font-size: 0.9em;">ğŸ‡§ğŸ‡· GRU</label>
                    <select name="gru_after" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 5px;">
                        <option value="1.5" selected>1.5 hours</option>
                        <option value="0.5">0.5 hours</option>
                        <option value="1.0">1 hour</option>
                        <option value="2.0">2 hours</option>
                        <option value="3.0">3 hours</option>
                    </select>
                </div>
                <div>
                    <label style="display: block; font-weight: 600; color: #555; margin-bottom: 5px; font-size: 0.9em;">ğŸ‡²ğŸ‡½ MEX</label>
                    <select name="mex_after" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 5px;">
                        <option value="1.5" selected>1.5 hours</option>
                        <option value="0.5">0.5 hours</option>
                        <option value="1.0">1 hour</option>
                        <option value="2.0">2 hours</option>
                        <option value="3.0">3 hours</option>
                    </select>
                </div>
                <div>
                    <label style="display: block; font-weight: 600; color: #555; margin-bottom: 5px; font-size: 0.9em;">ğŸŒ Other Intl</label>
                    <select name="international_after" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 5px;">
                        <option value="1.5" selected>1.5 hours</option>
                        <option value="0.5">0.5 hours</option>
                        <option value="1.0">1 hour</option>
                        <option value="2.0">2 hours</option>
                        <option value="3.0">3 hours</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="actions">
            <a href="{{ url_for('index') }}" class="btn-secondary">â† Cancel</a>
            <button type="submit" class="btn-primary">âœ“ Generate Calendar File</button>
        </div>
    </form>
    {% endif %}
</div>
{% endblock %}
