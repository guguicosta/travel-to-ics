{% extends "base.html" %}

{% block content %}
<div class="card">
    <form id="uploadForm" action="{{ url_for('upload_file') }}" method="post" enctype="multipart/form-data">
        <div class="upload-area" id="uploadArea" onclick="document.getElementById('fileInput').click()">
            <div class="upload-icon">ğŸ“„</div>
            <div class="upload-text">Click to upload or drag & drop</div>
            <div class="upload-hint">PDF files from CWT travel agents (max 16MB)</div>
        </div>

        <input type="file" id="fileInput" name="file" accept=".pdf" onchange="handleFileSelect(event)">

        <div id="fileName" class="file-name" style="display: none;"></div>

        <!-- Customization Options -->
        <div id="customOptions" style="display: none; margin-top: 30px; padding: 20px; background: #f8f9ff; border-radius: 10px;">
            <h3 style="color: #333; margin-bottom: 20px; text-align: center;">âš™ï¸ Customize Settings</h3>

            <!-- Output Method -->
            <div style="margin-bottom: 25px; padding: 15px; background: white; border-radius: 10px; border: 2px solid #667eea;">
                <h4 style="color: #333; margin-bottom: 15px; text-align: center;">ğŸ“… How would you like to add to calendar?</h4>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <label style="display: flex; align-items: center; padding: 15px; border: 2px solid #ddd; border-radius: 10px; cursor: pointer; transition: all 0.3s;" class="output-option">
                        <input type="radio" name="output_method" value="ics" checked style="margin-right: 10px;">
                        <div>
                            <div style="font-weight: 600; color: #333;">ğŸ“¥ Download ICS File</div>
                            <div style="font-size: 0.85em; color: #666; margin-top: 5px;">Traditional method - import manually</div>
                        </div>
                    </label>
                    <label style="display: flex; align-items: center; padding: 15px; border: 2px solid #ddd; border-radius: 10px; cursor: pointer; transition: all 0.3s;" class="output-option">
                        <input type="radio" name="output_method" value="google" style="margin-right: 10px;">
                        <div>
                            <div style="font-weight: 600; color: #333;">ğŸ”— Push to Google Calendar</div>
                            <div style="font-size: 0.85em; color: #666; margin-top: 5px;">Direct integration - one click!</div>
                        </div>
                    </label>
                </div>
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 25px;">
                <!-- Color Settings -->
                <div>
                    <label style="display: block; font-weight: 600; color: #333; margin-bottom: 8px;">
                        âœˆï¸ Flight & Commute Color
                    </label>
                    <select name="flight_color" id="flightColor" style="width: 100%; padding: 10px; border: 2px solid #667eea; border-radius: 8px; font-size: 1em;">
                        <option value="11" selected>ğŸŒ¸ Flamingo (Default)</option>
                        <option value="1">ğŸ’œ Lavender</option>
                        <option value="2">ğŸ’š Sage</option>
                        <option value="3">ğŸ‡ Grape</option>
                        <option value="4">ğŸŒ¸ Blossom</option>
                        <option value="5">ğŸŒ Banana</option>
                        <option value="6">ğŸŒ¿ Basil</option>
                        <option value="7">ğŸ”µ Peacock</option>
                        <option value="8">ğŸŒ«ï¸ Graphite</option>
                        <option value="9">ğŸ’™ Blueberry</option>
                        <option value="10">ğŸŠ Tangerine</option>
                    </select>
                </div>

                <div>
                    <label style="display: block; font-weight: 600; color: #333; margin-bottom: 8px;">
                        ğŸ¨ Hotel Color
                    </label>
                    <select name="hotel_color" id="hotelColor" style="width: 100%; padding: 10px; border: 2px solid #667eea; border-radius: 8px; font-size: 1em;">
                        <option value="6" selected>ğŸŒ¿ Sage (Default)</option>
                        <option value="1">ğŸ’œ Lavender</option>
                        <option value="2">ğŸ’š Basil Light</option>
                        <option value="3">ğŸ‡ Grape</option>
                        <option value="4">ğŸŒ¸ Blossom</option>
                        <option value="5">ğŸŒ Banana</option>
                        <option value="7">ğŸ”µ Peacock</option>
                        <option value="8">ğŸŒ«ï¸ Graphite</option>
                        <option value="9">ğŸ’™ Blueberry</option>
                        <option value="10">ğŸŠ Tangerine</option>
                        <option value="11">ğŸŒ¸ Flamingo</option>
                    </select>
                </div>
            </div>

            <!-- Airport Commute Times -->
            <div style="margin-bottom: 25px;">
                <h4 style="color: #333; margin-bottom: 15px;">ğŸš— Commute Before Departure</h4>

                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px;">
                    <div>
                        <label style="display: block; font-weight: 600; color: #555; margin-bottom: 5px; font-size: 0.9em;">
                            ğŸ‡¨ğŸ‡± SCL
                        </label>
                        <select name="scl_before" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 5px;">
                            <option value="2.5" selected>2.5 hours</option>
                            <option value="2.0">2 hours</option>
                            <option value="3.0">3 hours</option>
                            <option value="3.5">3.5 hours</option>
                            <option value="4.0">4 hours</option>
                        </select>
                    </div>

                    <div>
                        <label style="display: block; font-weight: 600; color: #555; margin-bottom: 5px; font-size: 0.9em;">
                            ğŸ‡¦ğŸ‡· AEP
                        </label>
                        <select name="aep_before" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 5px;">
                            <option value="3.5" selected>3.5 hours</option>
                            <option value="2.5">2.5 hours</option>
                            <option value="3.0">3 hours</option>
                            <option value="4.0">4 hours</option>
                        </select>
                    </div>

                    <div>
                        <label style="display: block; font-weight: 600; color: #555; margin-bottom: 5px; font-size: 0.9em;">
                            ğŸ‡¦ğŸ‡· EZE
                        </label>
                        <select name="eze_before" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 5px;">
                            <option value="3.5" selected>3.5 hours</option>
                            <option value="3.0">3 hours</option>
                            <option value="4.0">4 hours</option>
                            <option value="4.5">4.5 hours</option>
                        </select>
                    </div>

                    <div>
                        <label style="display: block; font-weight: 600; color: #555; margin-bottom: 5px; font-size: 0.9em;">
                            ğŸ‡§ğŸ‡· GRU
                        </label>
                        <select name="gru_before" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 5px;">
                            <option value="3.5" selected>3.5 hours</option>
                            <option value="3.0">3 hours</option>
                            <option value="4.0">4 hours</option>
                            <option value="4.5">4.5 hours</option>
                        </select>
                    </div>

                    <div>
                        <label style="display: block; font-weight: 600; color: #555; margin-bottom: 5px; font-size: 0.9em;">
                            ğŸ‡²ğŸ‡½ MEX
                        </label>
                        <select name="mex_before" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 5px;">
                            <option value="3.5" selected>3.5 hours</option>
                            <option value="3.0">3 hours</option>
                            <option value="4.0">4 hours</option>
                            <option value="4.5">4.5 hours</option>
                        </select>
                    </div>

                    <div>
                        <label style="display: block; font-weight: 600; color: #555; margin-bottom: 5px; font-size: 0.9em;">
                            ğŸŒ Other Intl
                        </label>
                        <select name="international_before" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 5px;">
                            <option value="3.5" selected>3.5 hours</option>
                            <option value="3.0">3 hours</option>
                            <option value="4.0">4 hours</option>
                            <option value="4.5">4.5 hours</option>
                            <option value="5.0">5 hours</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- After Landing Times -->
            <div style="margin-bottom: 20px;">
                <h4 style="color: #333; margin-bottom: 15px;">ğŸš— Commute After Landing</h4>

                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px;">
                    <div>
                        <label style="display: block; font-weight: 600; color: #555; margin-bottom: 5px; font-size: 0.9em;">
                            ğŸ‡¨ğŸ‡± SCL
                        </label>
                        <select name="scl_after" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 5px;">
                            <option value="1.0" selected>1 hour</option>
                            <option value="0.5">30 min</option>
                            <option value="1.5">1.5 hours</option>
                            <option value="2.0">2 hours</option>
                        </select>
                    </div>

                    <div>
                        <label style="display: block; font-weight: 600; color: #555; margin-bottom: 5px; font-size: 0.9em;">
                            ğŸ‡¦ğŸ‡· AEP
                        </label>
                        <select name="aep_after" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 5px;">
                            <option value="1.0" selected>1 hour</option>
                            <option value="0.5">30 min</option>
                            <option value="1.5">1.5 hours</option>
                            <option value="2.0">2 hours</option>
                        </select>
                    </div>

                    <div>
                        <label style="display: block; font-weight: 600; color: #555; margin-bottom: 5px; font-size: 0.9em;">
                            ğŸ‡¦ğŸ‡· EZE
                        </label>
                        <select name="eze_after" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 5px;">
                            <option value="1.5" selected>1.5 hours</option>
                            <option value="1.0">1 hour</option>
                            <option value="2.0">2 hours</option>
                            <option value="2.5">2.5 hours</option>
                        </select>
                    </div>

                    <div>
                        <label style="display: block; font-weight: 600; color: #555; margin-bottom: 5px; font-size: 0.9em;">
                            ğŸ‡§ğŸ‡· GRU
                        </label>
                        <select name="gru_after" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 5px;">
                            <option value="1.5" selected>1.5 hours</option>
                            <option value="1.0">1 hour</option>
                            <option value="2.0">2 hours</option>
                            <option value="2.5">2.5 hours</option>
                        </select>
                    </div>

                    <div>
                        <label style="display: block; font-weight: 600; color: #555; margin-bottom: 5px; font-size: 0.9em;">
                            ğŸ‡²ğŸ‡½ MEX
                        </label>
                        <select name="mex_after" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 5px;">
                            <option value="1.5" selected>1.5 hours</option>
                            <option value="1.0">1 hour</option>
                            <option value="2.0">2 hours</option>
                            <option value="2.5">2.5 hours</option>
                        </select>
                    </div>

                    <div>
                        <label style="display: block; font-weight: 600; color: #555; margin-bottom: 5px; font-size: 0.9em;">
                            ğŸŒ Other Intl
                        </label>
                        <select name="international_after" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 5px;">
                            <option value="1.5" selected>1.5 hours</option>
                            <option value="1.0">1 hour</option>
                            <option value="2.0">2 hours</option>
                            <option value="2.5">2.5 hours</option>
                            <option value="3.0">3 hours</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>

        <div style="text-align: center; margin-top: 30px;">
            <button type="submit" class="btn" id="submitBtn" disabled>
                ğŸš€ Convert to Calendar
            </button>
        </div>

        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p style="margin-top: 15px; color: #666;">Processing your travel itinerary...</p>
        </div>
    </form>
</div>

<div class="card">
    <h2 style="text-align: center; margin-bottom: 30px; color: #333;">What You'll Get</h2>
    <div class="features">
        <div class="feature">
            <div class="feature-icon">âœˆï¸</div>
            <div class="feature-title">Flight Details</div>
            <div class="feature-desc">Complete flight info with 48h alarm</div>
        </div>
        <div class="feature">
            <div class="feature-icon">ğŸš—</div>
            <div class="feature-title">Commute Times</div>
            <div class="feature-desc">Customizable airport travel times</div>
        </div>
        <div class="feature">
            <div class="feature-icon">ğŸ¨</div>
            <div class="feature-title">Hotel Stays</div>
            <div class="feature-desc">Check-in & check-out times</div>
        </div>
        <div class="feature">
            <div class="feature-icon">ğŸ”—</div>
            <div class="feature-title">Direct Push</div>
            <div class="feature-desc">One-click Google Calendar sync</div>
        </div>
    </div>
</div>

<script>
    const uploadArea = document.getElementById('uploadArea');
    const fileInput = document.getElementById('fileInput');
    const fileName = document.getElementById('fileName');
    const submitBtn = document.getElementById('submitBtn');
    const uploadForm = document.getElementById('uploadForm');
    const loading = document.getElementById('loading');
    const customOptions = document.getElementById('customOptions');

    // Prevent default drag behaviors
    ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
        uploadArea.addEventListener(eventName, preventDefaults, false);
        document.body.addEventListener(eventName, preventDefaults, false);
    });

    function preventDefaults(e) {
        e.preventDefault();
        e.stopPropagation();
    }

    // Highlight drop area when item is dragged over it
    ['dragenter', 'dragover'].forEach(eventName => {
        uploadArea.addEventListener(eventName, highlight, false);
    });

    ['dragleave', 'drop'].forEach(eventName => {
        uploadArea.addEventListener(eventName, unhighlight, false);
    });

    function highlight(e) {
        uploadArea.classList.add('dragover');
    }

    function unhighlight(e) {
        uploadArea.classList.remove('dragover');
    }

    // Handle dropped files
    uploadArea.addEventListener('drop', handleDrop, false);

    function handleDrop(e) {
        const dt = e.dataTransfer;
        const files = dt.files;

        if (files.length > 0) {
            fileInput.files = files;
            handleFileSelect({ target: { files: files } });
        }
    }

    function handleFileSelect(event) {
        const file = event.target.files[0];
        if (file) {
            fileName.textContent = `ğŸ“„ ${file.name} (${formatFileSize(file.size)})`;
            fileName.style.display = 'block';
            submitBtn.disabled = false;

            // Show customization options
            customOptions.style.display = 'block';

            // Update upload area
            uploadArea.querySelector('.upload-text').textContent = 'File selected!';
            uploadArea.querySelector('.upload-icon').textContent = 'âœ…';
        }
    }

    function formatFileSize(bytes) {
        if (bytes === 0) return '0 Bytes';
        const k = 1024;
        const sizes = ['Bytes', 'KB', 'MB'];
        const i = Math.floor(Math.log(bytes) / Math.log(k));
        return Math.round(bytes / Math.pow(k, i) * 100) / 100 + ' ' + sizes[i];
    }

    // Highlight selected output method
    document.querySelectorAll('.output-option').forEach(option => {
        option.addEventListener('click', function() {
            document.querySelectorAll('.output-option').forEach(opt => {
                opt.style.borderColor = '#ddd';
                opt.style.background = 'white';
            });
            this.style.borderColor = '#667eea';
            this.style.background = '#f8f9ff';
        });
    });

    // Show loading when form is submitted
    uploadForm.addEventListener('submit', function() {
        const outputMethod = document.querySelector('input[name="output_method"]:checked').value;

        submitBtn.disabled = true;
        if (outputMethod === 'google') {
            submitBtn.textContent = 'ğŸ”— Connecting to Google...';
            loading.querySelector('p').textContent = 'Connecting to Google Calendar...';
        } else {
            submitBtn.textContent = 'â³ Converting...';
            loading.querySelector('p').textContent = 'Processing your travel itinerary...';
        }
        loading.style.display = 'block';
    });
</script>
{% endblock %}
